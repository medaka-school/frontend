<!DOCTYPE html>
<html>
<head>
  <title>POST Request Example</title>
  <meta charset="UTF-8">
  <style>
    /* チャット風のCSS */
    .chat-container {
      border: 1px solid #ccc;
      padding: 10px;
      height: 300px;
      overflow-y: scroll;
    }

    .chat-message {
      background-color: #fff;
      border: 1px solid #ccc;
      border-radius: 5px;
      padding: 5px 10px;
      margin-bottom: 10px;
      max-width: 70%;
      word-break: break-all;
      float: left;
      clear: both;
    }

    .chat-response {
      background-color: #dff0d8;
      border: 1px solid #ccc;
      border-radius: 5px;
      padding: 5px 10px;
      margin-bottom: 10px;
      max-width: 70%;
      word-break: break-all;
      float: right;
      clear: both;
    }

  </style>
</head>
<body>

  <div class="chat-container">
    <div class="chat-message">こんにちは！</div>
    <div class="chat-response">メッセージを送ってね。</div>
  </div>

  <form id="myForm"
        method="post">
    <!-- <label for="name">名前：</label>
    <input type="text"
           id="name"
           name="name"><br><br>

    <label for="email">メールアドレス：</label>
    <input type="email"
           id="email"
           name="email"><br><br> -->

    <label for="message">メッセージ：</label>
    <textarea id="message"
              name="message"></textarea><br><br>

    <button type="submit"
            onclick="submitForm()">送信</button>
  </form>

  <script>
    function submitForm() {
      event.preventDefault(); // prevent default form submission

      var form = document.getElementById("myForm");
      var xhr = new XMLHttpRequest();

      xhr.open("POST", "http://localhost:5000/chat", true);
      xhr.setRequestHeader("Content-Type", "application/json");

      xhr.onreadystatechange = function () {
        // メッセージ送信時に送信メッセージを表示する
        if (xhr.readyState === 2) {
          var chatContainer = document.querySelector(".chat-container");
          var chatMessage = document.createElement("div");
          chatMessage.className = "chat-message";
          console.log(chatMessage);
          chatMessage.innerText = document.getElementById("message").value;
          chatContainer.appendChild(chatMessage);

          // フォームをクリアする
          form.reset();
        }

        if (xhr.readyState === 4 && xhr.status === 200) {
          // JSONレスポンスを取得し、表示する
          var response = JSON.parse(xhr.responseText);
          var chatContainer = document.querySelector(".chat-container");
          var chatResponse = document.createElement("div");
          chatResponse.className = "chat-response";
          chatResponse.innerText = response.message;
          chatContainer.appendChild(chatResponse);
        }
      };

      var formData = new FormData(form);
      var data = {};
      for (var key of formData.keys()) {
        data[key] = formData.get(key);
      }
      var json = JSON.stringify(data);
      xhr.send(json);

    }
  </script>

</body>
</html>
